# Amazon-Reviews-2023 — MapReduce Analytics

A fully reproducible analytics stack (Python 3 + **mrjob**) that crunches the 2023 Amazon review dumps into tidy CSVs and polished figures. This README now includes **one‑liner commands to run *every* MapReduce job and post‑processing step** so you can replicate the paper in minutes.

```
amazon-mapreduce/
├─- data/                  # Our data
├── jobs/                  # MapReduce scripts (*.py)
├── post_processing/       # pandas / matplotlib helpers
├── output/                # *.tsv / *.csv generated by jobs & helpers
├── figs/                  # PNG/SVG figures for report & slides
├── report/                # LaTeX source (amazon_mapreduce_report.tex)
├── env.yml                # exact conda spec
├── Makefile.example       # optional batch-run helper
└── README.md              # this file
```

---

## 1  Quick start (local machine)

```bash
# clone & enter
git clone https://github.com/<you>/amazon-mapreduce.git && cd amazon-mapreduce

# environment
conda env create -f env.yml && conda activate amazon-mr

# fetch a sample category (~150 MB)
wget -P data/ https://datarepo.eng.ucsd.edu/mcauley_group/data/amazon_v2/raw/review_categories/Digital_Music.jsonl.gz

###############################################################################
#                     ░ CORE 4 MAPREDUCE JOBS ░                               #
###############################################################################
python3 jobs/count_reviews.py        data/Digital_Music.jsonl.gz  > output/review_counts.tsv
python3 jobs/avg_rating.py           data/Digital_Music.jsonl.gz  > output/avg_rating.tsv
python3 jobs/top10_most_reviewed.py  data/Digital_Music.jsonl.gz  > output/top10.tsv
python3 jobs/avg_helpfulness.py      data/Digital_Music.jsonl.gz  > output/avg_helpfulness.txt

###############################################################################
#                     ░ ADVANCED ANALYSES ░                                   #
###############################################################################
# sentiment analysis
python3 jobs/sentiment_extract.py      data/Digital_Music.jsonl.gz  > output/reviews_for_nlp.tsv
python3  post_processing/sentiment_classify.py                               # creates CSV + sentiment_dist.png

# monthly rating trend
python3 jobs/monthly_avg_rating.py     data/Digital_Music.jsonl.gz  > output/monthly_avg.tsv
python3  post_processing/monthly_avg_rating_plot.py                         # monthly_avg_rating.png

# helpfulness ↔ rating correlation
python3 jobs/rating_helpfulness_pairs.py data/Digital_Music.jsonl.gz > output/rating_help.tsv
python3  post_processing/helpfulness_rating_corr.py                         # help_vs_rating.png

# frequent‑word mining (positive vs negative)
python3 jobs/word_counts.py --polarity pos data/Digital_Music.jsonl.gz > output/words_pos.tsv
python3 jobs/word_counts.py --polarity neg data/Digital_Music.jsonl.gz > output/words_neg.tsv
python3  post_processing/pos_neg_word_compare.py                            # pos_neg_topwords.csv

###############################################################################
# Optional: build all figures in one go (requires Makefile.example)
###############################################################################
make all          # runs both MR jobs & post-processing helpers
```

All helper scripts log their output paths; by default figures land in **`figs/`** and data tables in **`output/`**.

---

## 2  Batch execution helpers

### 2.1  Makefile (recommended)

Copy `Makefile.example` to `Makefile` ⇒ `make core`, `make advanced`, `make clean`.

### 2.2  Shell one‑liner

```bash
bash scripts/run_all_local.sh data/Digital_Music.jsonl.gz
```

This loops through every job and prints timing stats.

---

## 3  Running on Hadoop / EMR

```bash
python3 jobs/top10_most_reviewed.py -r hadoop \
  --hadoop-streaming-jar /path/to/hadoop-streaming.jar \
  s3://my-bucket/amazon2023/*.jsonl.gz  > output/top10.tsv
```

Supply an `mrjob.conf` (template in `configs/`) with S3 bucket, region and IAM.

---

## 4  Job catalogue (cheat‑sheet)

| Script                        | Purpose                              |
| ----------------------------- | ------------------------------------ |
| `count_reviews.py`            | reviews per **parent\_asin**         |
| `avg_rating.py`               | average ★ per product                |
| `top10_most_reviewed.py`      | 10 busiest products                  |
| `avg_helpfulness.py`          | global mean helpful‑vote ratio       |
| `sentiment_extract.py`        | review text → TSV for NLP            |
| `monthly_avg_rating.py`       | monthly ★ time‑series                |
| `rating_helpfulness_pairs.py` | rating ↔ helpfulness pairs           |
| `word_counts.py`              | token frequency (with polarity flag) |

---

## 5  LaTeX report

```bash
cd report && latexmk -pdf amazon_mapreduce_report.tex
```

Or drop the `.tex` into Overleaf—requires no extra packages beyond TeX Live 2022.

---

## 6  License

MIT—see `LICENSE`.

[mrjob]: https://github.com/Yelp/mrjob
